"use strict";(self.webpackChunkfront_simple=self.webpackChunkfront_simple||[]).push([[553],{6447:(A,_,m)=>{m.d(_,{H:()=>e});var e=function(c){return c.DIGIITALART="digitalart",c.PAINTING="painting",c.SCULPTURE="sculpture",c.INSTALLATION="installation",c.MIXEDMEDIA="mixedmedia",c.DRAWING="drawing",c.PHOTOGRAPH="photograph",c.PERFORMANCE="performance",c.COLLAGE="collage",c.VIDEOART="videoart",c.CREATIVECODE="creativecode",c.POETRY="poetry",c.VIDEODANCE="videodance",c}(e||{})},4553:(A,_,m)=>{m.r(_),m.d(_,{default:()=>k});var e=m(4438),f=m(177),c=m(33),E=m(7023),T=m(345),o=m(8590),r=m(3841),i=m(3373),x=m(8141),d=m(7468);function D(g,P){1&g&&(e.j41(0,"div",1)(1,"div",3)(2,"span",4),e.EFF(3,"Loading..."),e.k0s()()())}function n(g,P){if(1&g&&(e.j41(0,"div",2)(1,"div",5),e.EFF(2),e.k0s()()),2&g){const t=e.XpG();e.R7$(2),e.JRh(t.error())}}function v(g,P){if(1&g){const t=e.RV6();e.j41(0,"button",11),e.bIt("click",function(){e.eBV(t);const a=e.XpG(2);return e.Njj(a.rearrangeArtworks())}),e.EFF(1," Rearrange "),e.k0s(),e.j41(2,"button",12),e.bIt("click",function(){e.eBV(t);const a=e.XpG(2);return e.Njj(a.saveChanges())}),e.EFF(3," Save "),e.k0s()}}function $(g,P){if(1&g){const t=e.RV6();e.j41(0,"div",6)(1,"button",7),e.bIt("click",function(){e.eBV(t);const a=e.XpG();return e.Njj(a.toggleEdit())}),e.EFF(2),e.k0s(),e.DNE(3,v,4,0),e.k0s(),e.j41(4,"div",8)(5,"div",9),e.nrm(6,"iframe",10),e.k0s()()}if(2&g){const t=e.XpG();e.R7$(),e.AVh("btn-primary",!t.editMode())("btn-secondary",t.editMode()),e.R7$(),e.SpI(" ",t.editMode()?"Exit Edit":"Edit"," "),e.R7$(),e.vxM(3,t.editMode()?3:-1),e.R7$(3),e.Y8G("src",t.iframeSrc(),e.f$h)}}let k=(()=>{class g{constructor(){this.route=(0,e.WQX)(c.nX),this.router=(0,e.WQX)(c.Ix),this.vrConfigService=(0,e.WQX)(E.$),this.sanitizer=(0,e.WQX)(T.up),this.store=(0,e.WQX)(r.P),this.hydraScriptService=(0,e.WQX)(i.fC),this.textureService=(0,e.WQX)(i.RV),this.loading=(0,e.vPA)(!0),this.error=(0,e.vPA)(null),this.config=(0,e.vPA)(null),this.iframeSrc=(0,e.vPA)(null),this.editMode=(0,e.vPA)(!1),this.currentHash=(0,e.vPA)(""),this.hydraScript=(0,e.vPA)(null),this.textures=(0,e.vPA)(new Map),this.blobUrls=(0,e.vPA)([]),this.sceneEffect=(0,e.QZP)(()=>{const t=this.config();t&&this.generateScene(t)},{allowSignalWrites:!0}),this.cleanupEffect=(0,e.QZP)(t=>{t(()=>{this.blobUrls().forEach(s=>URL.revokeObjectURL(s))})})}ngOnInit(){this.route.params.subscribe(t=>{const s=t.configId,a=t.hash;s&&a&&(this.currentHash.set(a),this.loadConfig(s,a))})}loadConfig(t,s){this.loading.set(!0),this.error.set(null),this.vrConfigService.getRandomConfig(t,s).subscribe({next:a=>{this.config.set(a);const l=[];a.hydraScriptId&&l.push(this.hydraScriptService.getHydraScript(a.hydraScriptId).pipe((0,x.M)(p=>this.hydraScript.set(p))));const u=[a.floorTextureId,a.wallTextureId,a.ceilingTextureId,a.skyTextureId].filter(p=>!!p),y=new Map,h=u.filter(p=>!this.store.textures().some(w=>w.id===p)).map(p=>this.textureService.getTexture(p).pipe((0,x.M)(w=>{y.set(p,w)})));l.push(...h),l.length>0?(0,d.p)(l).subscribe({next:()=>{y.forEach(p=>{this.store.textures().some(w=>w.id===p.id)||this.store.addTexture(p)}),this.loading.set(!1)},error:p=>{console.error("Failed to load resources:",p),this.error.set("Failed to load resources"),this.loading.set(!1)}}):this.loading.set(!1)},error:a=>{this.error.set("Failed to load configuration"),this.loading.set(!1)}})}loadHydraScript(t){this.hydraScriptService.getHydraScript(t.hydraScriptId).subscribe({next:s=>{this.hydraScript.set(s),this.loading.set(!1)},error:s=>{console.error("Failed to load Hydra script:",s),this.error.set("Failed to load Hydra script"),this.loading.set(!1)}})}generateScene(t){if(t.randomAllowed&&t.artworks){const u={artworks:t.artworks.map(h=>h.id),transforms:t.artworkTransforms||{},timestamp:Date.now()},y=(0,o.Jh)(u);if(this.currentHash()!==y){this.currentHash.set(y);const h=this.router.createUrlTree([],{relativeTo:this.route,queryParams:{v:y}});this.router.navigateByUrl(h,{replaceUrl:!0})}}const s=this.createSceneHtml(t,this.hydraScript()),a=new Blob([s],{type:"text/html"}),l=URL.createObjectURL(a);this.blobUrls.update(u=>[...u,l]),this.iframeSrc.set(this.sanitizer.bypassSecurityTrustResourceUrl(l))}createSceneHtml(t,s){return console.log("Creating scene with config:",t),`\n<!DOCTYPE html>\n<html>\n<head>\n    <meta charset="utf-8">\n    <title>VR Gallery - ${t.title}</title>\n    <script src="https://kordac.qepri.xyz/room_002/assets/js/aframe.js"><\/script>\n    <script src="https://kordac.qepri.xyz/room_002/assets/js/xtras.js"><\/script>\n    <script src="https://kordac.qepri.xyz/room_002/assets/js/hydra.js"><\/script>\n</head>\n<body>\n    <a-scene vr-mode-ui="enabled: true" renderer="colorManagement: true" aframe-init>\n        <a-assets>\n            ${this.generateAssets(t)}\n        </a-assets>\n        \n        ${this.generateEnvironment(t)}\n        ${this.generateArtworks(t)}\n        ${this.generate3DObjects(t)}\n        ${this.generateCamera(t)}\n        \n        \x3c!-- Sky entity for Hydra visuals - Moved to generateEnvironment --\x3e\n        \n        <a-light type="ambient" color="#404040"></a-light>\n        <a-light type="directional" position="5 10 5" color="#444"></a-light>\n    </a-scene>\n    \n    <script>\n      // Debug script to verify what config is received\n      console.log('Config environment transforms:', ${JSON.stringify(t.environmentTransforms||{})});\n      \n      // Initialize Hydra\n      let hydra, hydraCanvas;\n      hydraCanvas = document.getElementById("hydraCanvas");\n      \n      hydra = new Hydra({\n        canvas: hydraCanvas,\n        enableStreamCapture: false,\n        detectAudio: ${s?.enableMic||!1},\n        detectVideo: ${s?.enableCamera||!1},\n        width: 512,\n        height: 512,\n      });\n      \n      // Hydra script\n      ${s?.hydraScript||""}\n      \n      // A-Frame components for Hydra integration\n      AFRAME.registerComponent("canvas-updater", {\n        dependencies: ["geometry", "material"],\n        tick: function () {\n          var el = this.el;\n          var material = el.getObject3D("mesh").material;\n          if (!material.map) return;\n          material.map.needsUpdate = true;\n        }\n      });\n      \n      AFRAME.registerComponent("aframe-init", {\n        init: function () {\n          // Apply Hydra canvas to fake sky\n          let fakeSky = document.querySelector("#fake_sky");\n          fakeSky.setAttribute("canvas-updater", "");\n          fakeSky.setAttribute("material", "src:#hydraCanvas; shader: flat; side: double;");\n        }\n      });\n      \n      ${this.generateEditScript()}\n      ${this.generateRandomizedScript(t)}\n      ${this.generate3DObjectComponents()}\n    <\/script>\n</body>\n</html>`}generateAssets(t){let s="";return t.artworks?.forEach(l=>{s+=`<img id="${l.id}" src="${l.fileUrl}" crossorigin="anonymous">`}),t.threeDObjects?.forEach(l=>{const u=l.metadata.fileFormat.toLowerCase();["gltf","glb","obj","ply","pcd"].includes(u)&&(s+=`<a-asset-item id="object-${l.id}" src="${l.objectCdnUrl}" crossorigin="anonymous"></a-asset-item>`),l.hasTextures&&l.textureCdnUrl&&(s+=`<img id="texture-${l.id}" src="${l.textureCdnUrl}" crossorigin="anonymous">`)}),[{id:t.floorTextureId,elementId:"floor-texture"},{id:t.wallTextureId,elementId:"wall-texture"},{id:t.ceilingTextureId,elementId:"ceiling-texture"},{id:t.skyTextureId,elementId:"sky-texture"}].forEach(({id:l,elementId:u})=>{if(!l)return;const y=this.store.textures().find(h=>h.id===l);y?s+=`<img id="${u}" src="${y.cdnUrl}" crossorigin="anonymous">`:l&&(s+=`<img id="${u}" src="data:image/gif;base64,R0lGODlhAQABAAAAACw=" crossorigin="anonymous">`,this.textureService.getTexture(l).subscribe({next:h=>{this.store.addTexture(h),setTimeout(()=>{const p=document.querySelector("iframe");p?.contentWindow&&p.contentWindow.postMessage({type:"updateTexture",elementId:u,src:h.cdnUrl},"*")},500)},error:h=>console.error(`Failed to load texture ${l}:`,h)}))}),s+='<canvas id="hydraCanvas" width="512" height="512"></canvas>',s}generate3DObjects(t){let s="";return t.threeDObjects?.forEach((a,l)=>{const u=t.threeDObjectTransforms?.[a.id],y=this.getFormattedVector(u?.position,this.getDefault3DObjectPosition(l,t.threeDObjects.length)),h=this.getFormattedVector(u?.rotation,"0 0 0"),p=this.getFormattedVector(u?.scale,"1 1 1"),w=a.metadata.fileFormat.toLowerCase();let b="";b=["gltf","glb"].includes(w)?`gltf-model="#object-${a.id}"`:"obj"===w?`obj-model="obj: #object-${a.id}"`:["ply","pcd"].includes(w)?`ply-model="src: #object-${a.id}"`:`gltf-model="#object-${a.id}"`,s+=`\n      <a-entity\n        id="${a.id}"\n        class="three-d-object"\n        position="${y}"\n        rotation="${h}"\n        scale="${p}"\n        ${b}\n        ${a.hasTextures&&a.textureCdnUrl?`material="src: #texture-${a.id}"`:""}>\n      </a-entity>\n    `}),s}generateEnvironment(t){let s="";if(t.floorTextureId){const h=t.environmentTransforms?.floor||{};s+=`\n      <a-plane \n        id="floor"\n        position="${h.position||"0 0 0"}" \n        rotation="${h.rotation||"-90 0 0"}" \n        scale="${h.scale||"1 1 1"}"\n        width="100" \n        height="100" \n        material="src: #floor-texture; repeat: ${t.floorTextureRepeat} ${t.floorTextureRepeat}"\n        class="environment">\n      </a-plane>\n    `}if(t.wallTextureId){const h=t.environmentTransforms?.walls||{};s+=`\n      <a-entity \n        id="walls"\n        position="${h.position||"0 0 0"}"\n        rotation="${h.rotation||"0 0 0"}"\n        scale="${h.scale||"1 1 1"}"\n        class="environment">\n        \x3c!-- Back wall --\x3e\n        <a-plane position="0 5 -20" width="40" height="10" material="src: #wall-texture; repeat: ${t.wallTextureRepeat} ${t.wallTextureRepeat}"></a-plane>\n        \x3c!-- Left wall --\x3e\n        <a-plane position="-20 5 0" rotation="0 90 0" width="40" height="10" material="src: #wall-texture; repeat: ${t.wallTextureRepeat} ${t.wallTextureRepeat}"></a-plane>\n        \x3c!-- Right wall --\x3e\n        <a-plane position="20 5 0" rotation="0 -90 0" width="40" height="10" material="src: #wall-texture; repeat: ${t.wallTextureRepeat} ${t.wallTextureRepeat}"></a-plane>\n      </a-entity>\n    `}if(t.ceilingTextureId){const h=t.environmentTransforms?.ceiling||{};s+=`\n      <a-plane\n        id="ceiling" \n        position="${h.position||"0 10 0"}" \n        rotation="${h.rotation||"90 0 0"}"\n        scale="${h.scale||"1 1 1"}" \n        width="40" \n        height="40" \n        material="src: #ceiling-texture; repeat: ${t.ceilingTextureRepeat} ${t.ceilingTextureRepeat}"\n        class="environment">\n      </a-plane>\n    `}if(t.skyTextureId){const h=t.environmentTransforms?.sky||{};s+=`\n      <a-sky \n        id="sky"\n        src="#sky-texture"\n        position="${h.position||"0 0 0"}"\n        rotation="${h.rotation||"0 0 0"}"\n        scale="${h.scale||"1 1 1"}"\n        animation="property: rotation; to: 0 360 0; loop: true; dur: 70000" \n        material="shader: flat; repeat: ${t.skyTextureRepeat} ${t.skyTextureRepeat}; side: back"\n        class="environment">\n      </a-sky>\n    `}const a=t.environmentTransforms?.fakeSky||{};return s+=`\n    <a-entity \n      id="fake_sky" \n      geometry="primitive: sphere; radius: 30" \n      position="${a.position||"0 1.7 0"}"\n      rotation="${a.rotation||"0 0 0"}"\n      scale="${a.scale||"-1 1 1"}"\n      material="opacity: 0.8; side: double; shader: flat;" \n      class="environment">\n    </a-entity>\n  `,s}generateArtworks(t){let s="";return t.artworks?.forEach((a,l)=>{const u=t.artworkTransforms?.[a.id],y=this.getFormattedVector(u?.position,this.getDefaultPosition(l,t.artworks.length)),h=this.getFormattedVector(u?.rotation,"0 0 0"),p=this.getFormattedVector(u?.scale,"1 1 1");s+=`\n      <a-plane\n        id="${a.id}"\n        src="#${a.id}"\n        position="${y}"\n        rotation="${h}"\n        scale="${p}"\n        material="shader: flat"\n        class="artwork"\n      ></a-plane>\n    `}),s}getFormattedVector(t,s){return t?"string"==typeof t?t:`${t.x} ${t.y} ${t.z}`:s}generateCamera(t){const s=t.environmentTransforms?.camera||{};return`\n    <a-entity \n      id="camera-rig"\n      position="${s.position||"0 1.7 5"}"\n      rotation="${s.rotation||"0 0 0"}">\n      <a-entity \n        camera\n        wasd-controls="acceleration: 10"\n        movement-controls="fly: ${t.flyAllowed}; speed: 0.05"\n        look-controls="reverseMouseDrag: false"\n        position="0 0 0">\n      </a-entity>\n    </a-entity>\n  `}generateEditScript(){return"\n  let selectedArtwork = null;\n    let transforms = {};\n    let artworkTransforms = {};\n    let threeDObjectTransforms = {};\n    let environmentTransforms = {};\n    \n    // Communication with parent\n    window.addEventListener('message', handleMessage);\n    \n    function handleMessage(e) {\n      switch(e.data.type) {\n        case 'rearrange':\n          rearrangeArtworks();\n          break;\n        case 'saveTransforms':\n          saveCurrentTransforms();\n          break;\n        case 'toggleEdit':\n          toggleEditMode(e.data.enabled);\n          break;\n        case 'updateTexture':\n          updateTexture(e.data.elementId, e.data.src);\n          break;\n      }\n    }\n    \n    function updateTexture(elementId, src) {\n      const imgElement = document.getElementById(elementId);\n      if (imgElement) {\n        imgElement.src = src;\n        imgElement.onload = () => {\n          // Select elements by attribute - properly escaped for template string\n          const skyElements = document.querySelectorAll('a-sky');\n          const materialElements = document.querySelectorAll('[material]');\n          \n          // Update all potentially affected elements\n          materialElements.forEach(el => {\n            const materialAttr = el.getAttribute('material');\n            if (materialAttr && materialAttr.includes('src: #' + elementId)) {\n              const mesh = el.getObject3D('mesh');\n              if (mesh && mesh.material) {\n                if (Array.isArray(mesh.material)) {\n                  mesh.material.forEach(mat => {\n                    if (mat.map) mat.map.needsUpdate = true;\n                  });\n                } else if (mesh.material.map) {\n                  mesh.material.map.needsUpdate = true;\n                }\n              }\n            }\n          });\n          \n          // Special handling for sky elements\n          skyElements.forEach(el => {\n            const srcAttr = el.getAttribute('src');\n            if (srcAttr === '#' + elementId) {\n              const mesh = el.getObject3D('mesh');\n              if (mesh && mesh.material && mesh.material.map) {\n                mesh.material.map.needsUpdate = true;\n              }\n            }\n          });\n        };\n      }\n    }\n    \n   function rearrangeArtworks() {\n      const artworks = document.querySelectorAll('.artwork');\n      artworks.forEach((artwork, i) => {\n        artwork.setAttribute('position', getGalleryPosition(i, artworks.length));\n      });\n      \n      const threeDObjects = document.querySelectorAll('.three-d-object');\n      threeDObjects.forEach((object, i) => {\n        object.setAttribute('position', get3DObjectPosition(i, threeDObjects.length));\n      });\n    }\n\n    function get3DObjectPosition(index, total) {\n      const x = (index % 3 - 1) * 4;\n      const z = -8 - Math.floor(index / 3) * 4;\n      return `${x} 1 ${z}`;\n    }\n    \n    function getGalleryPosition(index, total) {\n      const cols = Math.ceil(Math.sqrt(total));\n      const row = Math.floor(index / cols);\n      const col = index % cols;\n      const x = (col - (cols - 1) / 2) * 3;\n      const z = -5 - row * 3;\n      return `${x} 1.7 ${z}`;\n    }\n    \n function saveCurrentTransforms() {\n  // Save artwork transforms\n  document.querySelectorAll('.artwork').forEach(artwork => {\n    // Get position as THREE.Vector3 or Object {x, y, z}\n    const pos = artwork.getAttribute('position');\n    const rot = artwork.getAttribute('rotation');\n    const scl = artwork.getAttribute('scale');\n    \n    transforms[artwork.id] = {\n      position: parseVector(pos),\n      rotation: parseVector(rot),\n      scale: parseVector(scl)\n    };\n  });\n\n  // Save 3D object transforms\n    document.querySelectorAll('.three-d-object').forEach(object => {\n      const pos = object.getAttribute('position');\n      const rot = object.getAttribute('rotation');\n      const scl = object.getAttribute('scale');\n      \n      threeDObjectTransforms[object.id] = {\n        position: parseVector(pos),\n        rotation: parseVector(rot),\n        scale: parseVector(scl)\n      };\n    });\n  \n  // Save environment transforms\n  const environmentElements = {\n    floor: document.querySelector('#floor'),\n    walls: document.querySelector('#walls'),\n    ceiling: document.querySelector('#ceiling'),\n    sky: document.querySelector('#sky'),\n    fakeSky: document.querySelector('#fake_sky')\n  };\n  \n  // Create environment transform object\n  Object.entries(environmentElements).forEach(([key, element]) => {\n    if (element) {\n      const pos = element.getAttribute('position');\n      const rot = element.getAttribute('rotation');\n      const scl = element.getAttribute('scale');\n      \n      environmentTransforms[key] = {\n        position: formatVector(parseVector(pos)),\n        rotation: formatVector(parseVector(rot)),\n        scale: formatVector(parseVector(scl))\n      };\n    }\n  });\n  \n  // Capture camera's actual world position and rotation\n  const cameraEl = document.querySelector('[camera]');\n  \n  if (cameraEl && cameraEl.object3D) {\n    // Get camera's world position and rotation\n    const worldPos = new THREE.Vector3();\n    const worldQuat = new THREE.Quaternion();\n    const worldRot = new THREE.Euler();\n    \n    cameraEl.object3D.getWorldPosition(worldPos);\n    cameraEl.object3D.getWorldQuaternion(worldQuat);\n    worldRot.setFromQuaternion(worldQuat);\n    \n    // Convert rotation from radians to degrees\n    const rotDegrees = {\n      x: THREE.MathUtils.radToDeg(worldRot.x),\n      y: THREE.MathUtils.radToDeg(worldRot.y),\n      z: THREE.MathUtils.radToDeg(worldRot.z)\n    };\n    \n    // Save to environment transforms - using string concatenation instead of template literals\n    environmentTransforms.camera = {\n      position: worldPos.x.toFixed(4) + ' ' + worldPos.y.toFixed(4) + ' ' + worldPos.z.toFixed(4),\n      // rotation: rotDegrees.x.toFixed(4) + ' ' + rotDegrees.y.toFixed(4) + ' ' + rotDegrees.z.toFixed(4)\n    };\n  }\n  \n  window.parent.postMessage({ \n    type: 'transforms', \n    data: { \n      artworkTransforms: transforms,\n      threeDObjectTransforms: threeDObjectTransforms,\n      environmentTransforms: environmentTransforms \n    }\n  }, '*');\n}\n    \n    // Helper function to parse vector3 values\n    function parseVector(vec) {\n      if (typeof vec === 'string') {\n        const [x, y, z] = vec.split(' ').map(parseFloat);\n        return { x, y, z };\n      }\n      \n      return { \n        x: typeof vec.x === 'number' ? vec.x : parseFloat(vec.x),\n        y: typeof vec.y === 'number' ? vec.y : parseFloat(vec.y),\n        z: typeof vec.z === 'number' ? vec.z : parseFloat(vec.z)\n      };\n    }\n    \n    // Helper function to format vector object back to string\n    function formatVector(vec) {\n      return `${vec.x} ${vec.y} ${vec.z}`;\n    }\n  "}generateRandomizedScript(t){return t.randomized?"\n      // Scene is randomized - disable editing\n      console.log('This is a randomized scene configuration');\n    ":""}generate3DObjectComponents(){return"\n    // PLY Loader Component for Point Clouds\n    AFRAME.registerComponent('ply-model', {\n      schema: {\n        src: { type: 'asset' }\n      },\n      \n      init: function() {\n        if (typeof THREE.PLYLoader === 'undefined') {\n          console.warn('PLYLoader not available, skipping PLY model');\n          return;\n        }\n        \n        const loader = new THREE.PLYLoader();\n        const src = this.data.src;\n        \n        loader.load(src, (geometry) => {\n          const material = new THREE.PointsMaterial({ \n            color: 0xffffff, \n            size: 0.02,\n            vertexColors: true\n          });\n          const points = new THREE.Points(geometry, material);\n          this.el.setObject3D('mesh', points);\n        });\n      }\n    });\n    \n    // Enhanced OBJ Loader Component\n    AFRAME.registerComponent('obj-model', {\n      schema: {\n        obj: { type: 'asset' }\n      },\n      \n      init: function() {\n        if (typeof THREE.OBJLoader === 'undefined') {\n          console.warn('OBJLoader not available, skipping OBJ model');\n          return;\n        }\n        \n        const loader = new THREE.OBJLoader();\n        const src = this.data.obj;\n        \n        loader.load(src, (object) => {\n          this.el.setObject3D('mesh', object);\n        });\n      }\n    });\n  "}getDefaultPosition(t,s){const a=Math.ceil(Math.sqrt(s));return`${3*(t%a-(a-1)/2)} 1.7 ${-5-3*Math.floor(t/a)}`}toggleEdit(){this.editMode.update(t=>!t),this.sendToIframe({type:"toggleEdit",enabled:this.editMode()})}rearrangeArtworks(){this.sendToIframe({type:"rearrange"})}saveChanges(){this.sendToIframe({type:"saveTransforms"})}sendToIframe(t){const s=document.querySelector("iframe");s?.contentWindow&&s.contentWindow.postMessage(t,"*")}saveTransforms(t){const s=this.config();if(s){if(t.artworkTransforms){const l={...s.artworkTransforms||{},...t.artworkTransforms};s.artworkTransforms=l}if(t.threeDObjectTransforms){const l={...s.threeDObjectTransforms||{},...t.threeDObjectTransforms};s.threeDObjectTransforms=l}if(t.environmentTransforms){const l={...s.environmentTransforms||{},...t.environmentTransforms};s.environmentTransforms=l}this.vrConfigService.update(s.id,{artworkTransforms:s.artworkTransforms,threeDObjectTransforms:s.threeDObjectTransforms,environmentTransforms:s.environmentTransforms}).subscribe({next:()=>console.log("Transforms saved"),error:a=>console.error("Save failed",a)})}}getDefault3DObjectPosition(t,s){return`${4*(t%3-1)} 1 ${-8-4*Math.floor(t/3)}`}handleMessage(t){"transforms"===t.data.type&&this.saveTransforms(t.data.data)}static{this.\u0275fac=function(s){return new(s||g)}}static{this.\u0275cmp=e.VBU({type:g,selectors:[["app-vr-preview"]],hostBindings:function(s,a){1&s&&e.bIt("message",function(u){return a.handleMessage(u)},!1,e.tSv)},standalone:!0,features:[e.aNF],decls:4,vars:3,consts:[[1,"vr-preview-container"],[1,"loading-overlay"],[1,"error-overlay"],["role","status",1,"spinner-border"],[1,"visually-hidden"],[1,"alert","alert-danger"],[1,"vr-controls"],[1,"btn","btn-sm",3,"click"],[1,"card","iframe-card"],[1,"card-body","p-0"],["frameborder","0","allowfullscreen","","allowvr","",1,"vr-iframe",3,"src"],[1,"btn","btn-sm","btn-info",3,"click"],[1,"btn","btn-sm","btn-success",3,"click"]],template:function(s,a){1&s&&(e.j41(0,"div",0),e.DNE(1,D,4,0,"div",1)(2,n,3,1,"div",2)(3,$,7,7),e.k0s()),2&s&&(e.R7$(),e.vxM(1,a.loading()?1:-1),e.R7$(),e.vxM(2,a.error()?2:-1),e.R7$(),e.vxM(3,a.iframeSrc()&&!a.loading()?3:-1))},dependencies:[f.MD],styles:[".vr-preview-container[_ngcontent-%COMP%]{position:relative;width:100%;height:100vh;margin:0;padding:20px;overflow:hidden}.iframe-card[_ngcontent-%COMP%]{height:calc(100vh - 100px);margin:20px;border-radius:8px;overflow:hidden;box-shadow:0 4px 6px #0000001a}.vr-iframe[_ngcontent-%COMP%]{width:100%;height:100%;border:none;display:block;overflow:hidden}.loading-overlay[_ngcontent-%COMP%], .error-overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;justify-content:center;align-items:center;background:#000c;z-index:1000}.vr-controls[_ngcontent-%COMP%]{position:absolute;top:30px;left:30px;z-index:100;background:#000000b3;padding:8px;border-radius:4px;display:flex;gap:8px}"]})}}return g})()},2010:(A,_,m)=>{m.d(_,{v:()=>E});var e=m(5312),f=m(4438),c=m(1626);let E=(()=>{class T{constructor(r){this.http=r,this.apiUrl=e.c.apiUrl}findAll(r){return this.http.get(`${this.apiUrl}/${this.endpoint}`,{params:{...r}})}findOne(r){return this.http.get(`${this.apiUrl}/${this.endpoint}/${r}`)}create(r){return this.http.post(`${this.apiUrl}/${this.endpoint}`,r)}update(r,i){return this.http.patch(`${this.apiUrl}/${this.endpoint}/${r}`,i)}remove(r){return this.http.delete(`${this.apiUrl}/${this.endpoint}/${r}`)}static{this.\u0275fac=function(i){return new(i||T)(f.KVO(c.Qq))}}static{this.\u0275prov=f.jDH({token:T,factory:T.\u0275fac})}}return T})()},2249:(A,_,m)=>{m.d(_,{f:()=>E});var e=m(2010),f=m(4438),c=m(1626);let E=(()=>{class T extends e.v{constructor(r){super(r),this.http=r,this.endpoint="hydra-scripts"}getMyScripts(r){return this.http.get(`${this.apiUrl}/${this.endpoint}/my-scripts`,{params:{...r}})}getHydraScript(r){return this.http.get(`${this.apiUrl}/${this.endpoint}/${r}`)}static{this.\u0275fac=function(i){return new(i||T)(f.KVO(c.Qq))}}static{this.\u0275prov=f.jDH({token:T,factory:T.\u0275fac,providedIn:"root"})}}return T})()},3373:(A,_,m)=>{m.d(_,{gA:()=>E,vA:()=>e.v,AF:()=>r,fC:()=>x.f,UN:()=>T,xB:()=>o,RV:()=>i});var e=m(2010),f=m(4438),c=m(1626);let E=(()=>{class d extends e.v{constructor(n){super(n),this.http=n,this.endpoint="artist-profiles"}getMyProfile(){return this.http.get(`${this.apiUrl}/${this.endpoint}/my-profile`)}publishArtistSite(n){return this.http.post(`${this.apiUrl}/${this.endpoint}/${n}/publish`,{})}static{this.\u0275fac=function(v){return new(v||d)(f.KVO(c.Qq))}}static{this.\u0275prov=f.jDH({token:d,factory:d.\u0275fac,providedIn:"root"})}}return d})(),T=(()=>{class d extends e.v{constructor(n){super(n),this.http=n,this.endpoint="kwalhia-art"}getAllArtworks(n){return this.findAll(n)}getMyArtworks(n){return this.http.get(`${this.apiUrl}/${this.endpoint}/my-artwork`,{params:{...n}})}getArtwork(n){return this.findOne(n)}uploadArtwork(n,v){const $=new FormData;return $.append("file",v),Object.entries(n).forEach(([k,g])=>{null!=g&&$.append(k,g.toString())}),this.http.post(`${this.apiUrl}/${this.endpoint}`,$)}updateArtwork(n,v,$){const k=new FormData;return $&&k.append("file",$),Object.entries(v).forEach(([g,P])=>{null!=P&&k.append(g,P.toString())}),this.http.patch(`${this.apiUrl}/${this.endpoint}/${n}`,k)}uploadWithFormData(n){return this.http.post(`${this.apiUrl}/${this.endpoint}`,n)}deleteArtwork(n){return this.remove(n)}create(n){return console.warn("Please use uploadArtwork method instead of create for adding new artwork"),super.create(n)}static{this.\u0275fac=function(v){return new(v||d)(f.KVO(c.Qq))}}static{this.\u0275prov=f.jDH({token:d,factory:d.\u0275fac,providedIn:"root"})}}return d})(),o=(()=>{class d extends e.v{constructor(n){super(n),this.http=n,this.endpoint="series"}getMySeries(n){return this.http.get(`${this.apiUrl}/${this.endpoint}/my-series`,{params:{...n}})}static{this.\u0275fac=function(v){return new(v||d)(f.KVO(c.Qq))}}static{this.\u0275prov=f.jDH({token:d,factory:d.\u0275fac,providedIn:"root"})}}return d})(),r=(()=>{class d extends e.v{constructor(n){super(n),this.http=n,this.endpoint="galleries"}getMyGallery(){return this.http.get(`${this.apiUrl}/${this.endpoint}/my-gallery`)}static{this.\u0275fac=function(v){return new(v||d)(f.KVO(c.Qq))}}static{this.\u0275prov=f.jDH({token:d,factory:d.\u0275fac,providedIn:"root"})}}return d})(),i=(()=>{class d extends e.v{constructor(n){super(n),this.http=n,this.endpoint="textures"}getTexture(n){return this.http.get(`${this.apiUrl}/${this.endpoint}/${n}`)}getMyTextures(n){return this.http.get(`${this.apiUrl}/${this.endpoint}/my-textures`,{params:{...n}})}getTexturesByType(n,v){return this.http.get(`${this.apiUrl}/${this.endpoint}/type/${n}`,{params:{...v}})}uploadTexture(n,v,$=!1){const k=new FormData;return k.append("file",v),k.append("type",n),k.append("isPublic",$.toString()),this.http.post(`${this.apiUrl}/${this.endpoint}`,k)}static{this.\u0275fac=function(v){return new(v||d)(f.KVO(c.Qq))}}static{this.\u0275prov=f.jDH({token:d,factory:d.\u0275fac,providedIn:"root"})}}return d})();var x=m(2249)},3841:(A,_,m)=>{m.d(_,{P:()=>c});var e=m(4438);m(6447);let c=(()=>{class E{constructor(){this.validationTrigger=(0,e.vPA)(null),this.artistProfileForm=(0,e.vPA)(null),this.artistProfile=(0,e.vPA)(null),this.artworkForms=(0,e.vPA)([]),this.artworks=(0,e.vPA)([]),this.galleryForm=(0,e.vPA)(null),this.gallery=(0,e.vPA)(null),this.seriesForms=(0,e.vPA)([]),this.series=(0,e.vPA)([]),this.curatedSelectionForm=(0,e.vPA)(null),this.curatedSelections=(0,e.vPA)([]),this.artworkFiles=(0,e.vPA)(new Map),this.vrConfigs=(0,e.vPA)([]),this.textures=(0,e.vPA)([]),this.hydraScripts=(0,e.vPA)([]),this.threeDObjects=(0,e.vPA)([])}setArtistProfileForm(o){this.artistProfileForm.set(o)}getArtistProfileForm(){return this.artistProfileForm()}setArtistProfile(o){this.artistProfile.set(o)}addArtworkForm(o,r){const i=crypto.randomUUID(),x={...o,_tempId:i};this.artworkForms.update(d=>[...d,x]),this.artworkFiles.update(d=>{const D=new Map(d);return D.set(i,r),D})}getArtworkForms(){return this.artworkForms()}getArtworkFile(o){return this.artworkFiles()?.get(o)}addArtwork(o){this.artworks.update(r=>[...r,o])}setGalleryForm(o){this.galleryForm.set(o)}getGalleryForm(){return this.galleryForm()}setGallery(o){this.gallery.set(o)}addSeriesForm(o){this.seriesForms.set([o])}getSeriesForms(){return this.seriesForms()}addSeries(o){this.series.update(r=>[...r,o])}reset(){this.artistProfileForm.set(null),this.artistProfile.set(null),this.artworkForms.set([]),this.artworks.set([]),this.galleryForm.set(null),this.gallery.set(null),this.seriesForms.set([]),this.series.set([]),this.curatedSelectionForm.set(null),this.curatedSelections.set([]),this.artworkFiles.set(new Map)}removeArtwork(o){this.artworks.update(r=>r.filter(i=>i.id!==o))}removeSeries(o){this.series.update(r=>r.filter(i=>i.id!==o)),this.artworks.update(r=>r.map(i=>i.seriesId===o?{...i,seriesId:void 0,series:void 0}:i))}updateArtwork(o){this.artworks.update(r=>r.map(i=>i.id===o.id?o:i))}removeArtworkForm(o){this.artworkForms.update(r=>r.filter(i=>i._tempId!==o)),this.artworkFiles.update(r=>{const i=new Map(r);return i.delete(o),i})}updateArtworkForm(o,r){this.artworkForms.update(i=>i.map(x=>x._tempId===o?{...r,_tempId:x._tempId}:x))}updateArtworkFile(o,r){this.artworkFiles.update(i=>{const x=new Map(i);return x.set(o,r),x})}addVrConfig(o){this.vrConfigs.update(r=>[...r,o])}updateVrConfig(o){this.vrConfigs.update(r=>r.map(i=>i.id===o.id?o:i))}removeVrConfig(o){this.vrConfigs.update(r=>r.filter(i=>i.id!==o))}addTexture(o){this.textures.update(r=>[...r,o])}updateTexture(o){this.textures.update(r=>r.map(i=>i.id===o.id?o:i))}removeTexture(o){this.textures.update(r=>r.filter(i=>i.id!==o))}addHydraScript(o){this.hydraScripts.update(r=>[...r,o])}updateHydraScript(o){this.hydraScripts.update(r=>r.map(i=>i.id===o.id?o:i))}removeHydraScript(o){this.hydraScripts.update(r=>r.filter(i=>i.id!==o))}addThreeDObject(o){this.threeDObjects.update(r=>[...r,o])}updateThreeDObject(o){this.threeDObjects.update(r=>r.map(i=>i.id===o.id?o:i))}removeThreeDObject(o){this.threeDObjects.update(r=>r.filter(i=>i.id!==o))}static{this.\u0275fac=function(r){return new(r||E)}}static{this.\u0275prov=e.jDH({token:E,factory:E.\u0275fac,providedIn:"root"})}}return E})()}}]);