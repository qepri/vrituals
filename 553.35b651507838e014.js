"use strict";(self.webpackChunkfront_simple=self.webpackChunkfront_simple||[]).push([[553],{4553:(S,w,d)=>{d.r(w),d.d(w,{default:()=>k});var e=d(4438),g=d(177),b=d(33),E=d(5794),y=d(7023),D=d(345),m=d(8590),x=d(3841),A=d(3373),c=d(8141),R=d(7468);function s(h,C){1&h&&(e.j41(0,"div",1)(1,"div",3)(2,"span",4),e.EFF(3,"Loading..."),e.k0s()()())}function f(h,C){if(1&h&&(e.j41(0,"div",2)(1,"div",5),e.EFF(2),e.k0s()()),2&h){const t=e.XpG();e.R7$(2),e.JRh(t.error())}}function $(h,C){if(1&h){const t=e.RV6();e.j41(0,"button",14),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.rearrangeArtworks())}),e.EFF(1," Rearrange "),e.k0s()}}function v(h,C){if(1&h){const t=e.RV6();e.j41(0,"div",6)(1,"button",7),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.toggleEdit())}),e.EFF(2),e.k0s(),e.DNE(3,$,2,0,"button",8),e.j41(4,"button",9),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.saveChanges())}),e.EFF(5," Save "),e.k0s(),e.j41(6,"button",10),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.toggleInspector())}),e.EFF(7," \u{1f50d} Inspector "),e.k0s()(),e.j41(8,"div",11)(9,"div",12),e.nrm(10,"iframe",13),e.k0s()()}if(2&h){const t=e.XpG();e.R7$(),e.AVh("btn-primary",!t.editMode())("btn-secondary",t.editMode()),e.R7$(),e.SpI(" ",t.editMode()?"Exit Edit":"Edit"," "),e.R7$(),e.vxM(3,t.editMode()?3:-1),e.R7$(7),e.Y8G("src",t.iframeSrc(),e.f$h)}}let k=(()=>{class h{constructor(){this.route=(0,e.WQX)(b.nX),this.router=(0,e.WQX)(b.Ix),this.vrConfigService=(0,e.WQX)(y.$),this.sanitizer=(0,e.WQX)(D.up),this.store=(0,e.WQX)(x.P),this.hydraScriptService=(0,e.WQX)(A.fC),this.textureService=(0,e.WQX)(A.RV),this.toastr=(0,e.WQX)(E.tw),this.loading=(0,e.vPA)(!0),this.error=(0,e.vPA)(null),this.config=(0,e.vPA)(null),this.iframeSrc=(0,e.vPA)(null),this.editMode=(0,e.vPA)(!1),this.currentHash=(0,e.vPA)(""),this.hydraScript=(0,e.vPA)(null),this.textures=(0,e.vPA)(new Map),this.blobUrls=(0,e.vPA)([]),this.sceneEffect=(0,e.QZP)(()=>{const t=this.config();t&&this.generateScene(t)},{allowSignalWrites:!0}),this.cleanupEffect=(0,e.QZP)(t=>{t(()=>{this.blobUrls().forEach(r=>URL.revokeObjectURL(r))})})}ngOnInit(){this.route.params.subscribe(t=>{const r=t.configId,o=t.hash;r&&o&&(this.currentHash.set(o),this.loadConfig(r,o))})}loadConfig(t,r){this.loading.set(!0),this.error.set(null),this.vrConfigService.getRandomConfig(t,r).subscribe({next:o=>{this.config.set(o);const a=[];o.hydraScriptId&&a.push(this.hydraScriptService.getHydraScript(o.hydraScriptId).pipe((0,c.M)(i=>this.hydraScript.set(i))));const n=[o.floorTextureId,o.wallTextureId,o.ceilingTextureId,o.skyTextureId].filter(i=>!!i),p=new Map,l=n.filter(i=>!this.store.textures().some(u=>u.id===i)).map(i=>this.textureService.getTexture(i).pipe((0,c.M)(u=>{p.set(i,u)})));a.push(...l),a.length>0?(0,R.p)(a).subscribe({next:()=>{p.forEach(i=>{this.store.textures().some(u=>u.id===i.id)||this.store.addTexture(i)}),this.loading.set(!1)},error:i=>{console.error("Failed to load resources:",i),this.error.set("Failed to load resources"),this.loading.set(!1)}}):this.loading.set(!1)},error:o=>{this.error.set("Failed to load configuration"),this.loading.set(!1)}})}loadHydraScript(t){this.hydraScriptService.getHydraScript(t.hydraScriptId).subscribe({next:r=>{this.hydraScript.set(r),this.loading.set(!1)},error:r=>{console.error("Failed to load Hydra script:",r),this.error.set("Failed to load Hydra script"),this.loading.set(!1)}})}generateScene(t){if(t.randomAllowed&&t.artworks){const n={artworks:t.artworks.map(l=>l.id),transforms:t.artworkTransforms||{},timestamp:Date.now()},p=(0,m.Jh)(n);if(this.currentHash()!==p){this.currentHash.set(p);const l=this.router.createUrlTree([],{relativeTo:this.route,queryParams:{v:p}});this.router.navigateByUrl(l,{replaceUrl:!0})}}const r=this.createSceneHtml(t,this.hydraScript()),o=new Blob([r],{type:"text/html"}),a=URL.createObjectURL(o);this.blobUrls.update(n=>[...n,a]),this.iframeSrc.set(this.sanitizer.bypassSecurityTrustResourceUrl(a))}createSceneHtml(t,r){return console.log("Creating scene with config:",t),`\n<!DOCTYPE html>\n<html>\n<head>\n    <meta charset="utf-8">\n    <title>VR Gallery - ${t.title}</title>\n    <script src="https://kordac.qepri.xyz/room_002/assets/js/aframe.js"><\/script>\n    <script src="https://kordac.qepri.xyz/room_002/assets/js/xtras.js"><\/script>\n    <script src="https://kordac.qepri.xyz/room_002/assets/js/hydra.js"><\/script>\n</head>\n<body>\n    <a-scene vr-mode-ui="enabled: true" renderer="colorManagement: true" aframe-init>\n        <a-assets>\n            ${this.generateAssets(t)}\n        </a-assets>\n        \n        ${this.generateEnvironment(t)}\n        ${this.generateRoomGeometries(t)}\n        ${this.generateArtworks(t)}\n        ${this.generate3DObjects(t)}\n        ${this.generateCamera(t)}\n        \n        \x3c!-- Sky entity for Hydra visuals - Moved to generateEnvironment --\x3e\n        \n        <a-light type="ambient" color="#404040"></a-light>\n        <a-light type="directional" position="5 10 5" color="#444"></a-light>\n    </a-scene>\n    \n    <script>\n      // Debug script to verify what config is received\n      console.log('Config environment transforms:', ${JSON.stringify(t.environmentTransforms||{})});\n      \n      // Initialize Hydra\n      let hydra, hydraCanvas;\n      hydraCanvas = document.getElementById("hydraCanvas");\n      \n      hydra = new Hydra({\n        canvas: hydraCanvas,\n        enableStreamCapture: false,\n        detectAudio: ${r?.enableMic||!1},\n        detectVideo: ${r?.enableCamera||!1},\n        width: 512,\n        height: 512,\n      });\n      \n      // Hydra script\n      ${r?.hydraScript||""}\n      \n      // A-Frame components for Hydra integration\n      AFRAME.registerComponent("canvas-updater", {\n        dependencies: ["geometry", "material"],\n        tick: function () {\n          var el = this.el;\n          var material = el.getObject3D("mesh").material;\n          if (!material.map) return;\n          material.map.needsUpdate = true;\n        }\n      });\n      \n      AFRAME.registerComponent("aframe-init", {\n        init: function () {\n          // Apply Hydra canvas to fake sky\n          let fakeSky = document.querySelector("#fake_sky");\n          fakeSky.setAttribute("canvas-updater", "");\n          fakeSky.setAttribute("material", "src:#hydraCanvas; shader: flat; side: double;");\n        }\n      });\n      \n      ${this.generateEditScript()}\n      ${this.generateRandomizedScript(t)}\n      ${this.generate3DObjectComponents()}\n    <\/script>\n</body>\n</html>`}generateAssets(t){let r="";return t.artworks?.forEach(n=>{r+=`<img id="${n.id}" src="${n.fileUrl}" crossorigin="anonymous">`}),t.threeDObjects?.forEach(n=>{const p=n.metadata.fileFormat.toLowerCase();["gltf","glb","obj","ply","pcd"].includes(p)&&(r+=`<a-asset-item id="object-${n.id}" src="${n.objectCdnUrl}" crossorigin="anonymous"></a-asset-item>`),n.hasTextures&&n.textureCdnUrl&&(r+=`<img id="texture-${n.id}" src="${n.textureCdnUrl}" crossorigin="anonymous" >`)}),[{geometry:t.floorGeometry},{geometry:t.wallsGeometry},{geometry:t.ceilingGeometry}].forEach(({geometry:n})=>{if(!n)return;const p=n.metadata.fileFormat.toLowerCase();["gltf","glb","obj","ply","pcd"].includes(p)&&(r+=`<a-asset-item id="geometry-${n.id}" src="${n.objectCdnUrl}" crossorigin="anonymous"></a-asset-item>`)}),[{id:t.floorTextureId,elementId:"floor-texture"},{id:t.wallTextureId,elementId:"wall-texture"},{id:t.ceilingTextureId,elementId:"ceiling-texture"},{id:t.skyTextureId,elementId:"sky-texture"}].forEach(({id:n,elementId:p})=>{if(!n)return;const l=this.store.textures().find(i=>i.id===n);l?r+=`<img id="${p}" src="${l.cdnUrl}" crossorigin="anonymous">`:n&&(r+=`<img id="${p}" src="data:image/gif;base64,R0lGODlhAQABAAAAACw=" crossorigin="anonymous">`,this.textureService.getTexture(n).subscribe({next:i=>{this.store.addTexture(i),setTimeout(()=>{const u=document.querySelector("iframe");u?.contentWindow&&u.contentWindow.postMessage({type:"updateTexture",elementId:p,src:i.cdnUrl},"*")},500)},error:i=>console.error(`Failed to load texture ${n}:`,i)}))}),r+='<canvas id="hydraCanvas" width="512" height="512"></canvas>',r}generate3DObjects(t){let r="";return t.threeDObjects?.forEach((o,a)=>{const n=t.threeDObjectTransforms?.[o.id],p=this.getFormattedVector(n?.position,this.getDefault3DObjectPosition(a,t.threeDObjects.length)),l=this.getFormattedVector(n?.rotation,"0 0 0"),i=this.getFormattedVector(n?.scale,"1 1 1"),u=o.metadata.fileFormat.toLowerCase();let T="";T=["gltf","glb"].includes(u)?`gltf-model="#object-${o.id}"`:"obj"===u?`obj-model="obj: #object-${o.id}"`:["ply","pcd"].includes(u)?`ply-model="src: #object-${o.id}"`:`gltf-model="#object-${o.id}"`,r+=`\n      <a-entity\n        id="${o.id}"\n        class="three-d-object"\n        position="${p}"\n        rotation="${l}"\n        scale="${i}"\n        ${T}\n        ${o.hasTextures&&o.textureCdnUrl?`material="src: #texture-${o.id}"`:""}>\n      </a-entity>\n    `}),r}generateRoomGeometries(t){let r="";return[{geometry:t.floorGeometry,type:"floor",textureId:t.floorTextureId,repeat:t.floorTextureRepeat},{geometry:t.wallsGeometry,type:"walls",textureId:t.wallTextureId,repeat:t.wallTextureRepeat},{geometry:t.ceilingGeometry,type:"ceiling",textureId:t.ceilingTextureId,repeat:t.ceilingTextureRepeat}].forEach(({geometry:a,type:n,textureId:p,repeat:l})=>{if(!a)return;const i=t.geometryTransforms?.[n]||{},u=this.getFormattedVector(i.position,"0 0 0"),T=this.getFormattedVector(i.rotation,"0 0 0"),O=this.getFormattedVector(i.scale,"1 1 1"),M=a.metadata.fileFormat.toLowerCase();let _="";_=["gltf","glb"].includes(M)?`gltf-model="#geometry-${a.id}"`:"obj"===M?`obj-model="obj: #geometry-${a.id}"`:["ply","pcd"].includes(M)?`ply-model="src: #geometry-${a.id}"`:`gltf-model="#geometry-${a.id}"`;let P="";p&&(P=`material="src: #${"walls"===n?"wall":n}-texture; repeat: ${l} ${l}"`),r+=`\n      <a-entity\n        id="geometry-${a.id}"\n        class="room-geometry ${n}"\n        data-geometry-type="${n}"\n        position="${u}"\n        rotation="${T}"\n        scale="${O}"\n        ${_}\n        ${P}>\n      </a-entity>\n    `}),r}generateEnvironment(t){let r="";if(t.floorTextureId&&!t.floorGeometryId){const l=t.environmentTransforms?.floor||{};r+=`\n      <a-plane \n        id="floor"\n        position="${l.position||"0 0 0"}" \n        rotation="${l.rotation||"-90 0 0"}" \n        scale="${l.scale||"1 1 1"}"\n        width="100" \n        height="100" \n        material="src: #floor-texture; repeat: ${t.floorTextureRepeat} ${t.floorTextureRepeat}"\n        class="environment">\n      </a-plane>\n    `}if(t.wallTextureId&&!t.wallsGeometryId){const l=t.environmentTransforms?.walls||{};r+=`\n      <a-entity \n        id="walls"\n        position="${l.position||"0 0 0"}"\n        rotation="${l.rotation||"0 0 0"}"\n        scale="${l.scale||"1 1 1"}"\n        class="environment">\n        \x3c!-- Back wall --\x3e\n        <a-plane position="0 5 -20" width="40" height="10" material="src: #wall-texture; repeat: ${t.wallTextureRepeat} ${t.wallTextureRepeat}"></a-plane>\n        \x3c!-- Left wall --\x3e\n        <a-plane position="-20 5 0" rotation="0 90 0" width="40" height="10" material="src: #wall-texture; repeat: ${t.wallTextureRepeat} ${t.wallTextureRepeat}"></a-plane>\n        \x3c!-- Right wall --\x3e\n        <a-plane position="20 5 0" rotation="0 -90 0" width="40" height="10" material="src: #wall-texture; repeat: ${t.wallTextureRepeat} ${t.wallTextureRepeat}"></a-plane>\n      </a-entity>\n    `}if(t.ceilingTextureId&&!t.ceilingGeometryId){const l=t.environmentTransforms?.ceiling||{};r+=`\n      <a-plane\n        id="ceiling" \n        position="${l.position||"0 10 0"}" \n        rotation="${l.rotation||"90 0 0"}"\n        scale="${l.scale||"1 1 1"}" \n        width="40" \n        height="40" \n        material="src: #ceiling-texture; repeat: ${t.ceilingTextureRepeat} ${t.ceilingTextureRepeat}"\n        class="environment">\n      </a-plane>\n    `}if(t.skyTextureId){const l=t.environmentTransforms?.sky||{};r+=`\n      <a-sky \n        id="sky"\n        src="#sky-texture"\n        position="${l.position||"0 0 0"}"\n        rotation="${l.rotation||"0 0 0"}"\n        scale="${l.scale||"1 1 1"}"\n        animation="property: rotation; to: 0 360 0; loop: true; dur: 70000" \n        material="shader: flat; repeat: ${t.skyTextureRepeat} ${t.skyTextureRepeat}; side: back"\n        class="environment">\n      </a-sky>\n    `}const o=t.environmentTransforms?.fakeSky||{};return r+=`\n    <a-entity \n      id="fake_sky" \n      geometry="primitive: sphere; radius: 30" \n      position="${o.position||"0 1.7 0"}"\n      rotation="${o.rotation||"0 0 0"}"\n      scale="${o.scale||"-1 1 1"}"\n      material="opacity: 0.8; shader: flat; side: double" \n      class="environment">\n    </a-entity>\n  `,r}generateArtworks(t){let r="";return t.artworks?.forEach((o,a)=>{const n=t.artworkTransforms?.[o.id],p=this.getFormattedVector(n?.position,this.getDefaultPosition(a,t.artworks.length)),l=this.getFormattedVector(n?.rotation,"0 0 0"),i=this.getFormattedVector(n?.scale,"1 1 1");r+=`\n      <a-plane\n        id="${o.id}"\n        src="#${o.id}"\n        position="${p}"\n        rotation="${l}"\n        scale="${i}"\n        material="shader: flat; side: double;"\n        class="artwork"\n      ></a-plane>\n    `}),r}getFormattedVector(t,r){return t?"string"==typeof t?t:`${t.x} ${t.y} ${t.z}`:r}generateCamera(t){const r=t.environmentTransforms?.camera||{};return`\n    <a-entity \n      id="camera-rig"\n      position="${r.position||"0 1.7 5"}"\n      rotation="${r.rotation||"0 0 0"}">\n      <a-entity \n        camera\n        wasd-controls="acceleration: 10"\n        movement-controls="fly: ${t.flyAllowed}; speed: 0.05"\n        look-controls="reverseMouseDrag: false"\n        position="0 0 0">\n      </a-entity>\n    </a-entity>\n  `}generateEditScript(){return"\n  let selectedArtwork = null;\n    let transforms = {};\n    let artworkTransforms = {};\n    let threeDObjectTransforms = {};\n    let environmentTransforms = {};\n    \n    // Communication with parent\n    window.addEventListener('message', handleMessage);\n    \n    function handleMessage(e) {\n      switch(e.data.type) {\n        case 'rearrange':\n          rearrangeArtworks();\n          break;\n        case 'saveTransforms':\n          saveCurrentTransforms();\n          break;\n        case 'toggleEdit':\n          toggleEditMode(e.data.enabled);\n          break;\n        case 'updateTexture':\n          updateTexture(e.data.elementId, e.data.src);\n          break;\n        case 'toggleInspector':\n          toggleInspector();\n          break;\n      }\n    }\n    \n    function updateTexture(elementId, src) {\n      const imgElement = document.getElementById(elementId);\n      if (imgElement) {\n        imgElement.src = src;\n        imgElement.onload = () => {\n          // Select elements by attribute - properly escaped for template string\n          const skyElements = document.querySelectorAll('a-sky');\n          const materialElements = document.querySelectorAll('[material]');\n          \n          // Update all potentially affected elements\n          materialElements.forEach(el => {\n            const materialAttr = el.getAttribute('material');\n            if (materialAttr && materialAttr.includes('src: #' + elementId)) {\n              const mesh = el.getObject3D('mesh');\n              if (mesh && mesh.material) {\n                if (Array.isArray(mesh.material)) {\n                  mesh.material.forEach(mat => {\n                    if (mat.map) mat.map.needsUpdate = true;\n                  });\n                } else if (mesh.material.map) {\n                  mesh.material.map.needsUpdate = true;\n                }\n              }\n            }\n          });\n          \n          // Special handling for sky elements\n          skyElements.forEach(el => {\n            const srcAttr = el.getAttribute('src');\n            if (srcAttr === '#' + elementId) {\n              const mesh = el.getObject3D('mesh');\n              if (mesh && mesh.material && mesh.material.map) {\n                mesh.material.map.needsUpdate = true;\n              }\n            }\n          });\n        };\n      }\n    }\n    \n   function rearrangeArtworks() {\n      const artworks = document.querySelectorAll('.artwork');\n      artworks.forEach((artwork) => {\n        // Random position within gallery bounds\n        const x = (Math.random() - 0.5) * 20; // -10 to 10\n        const y = 1 + Math.random() * 3;      // 1 to 4\n        const z = -3 - Math.random() * 10;    // -3 to -13\n        artwork.setAttribute('position', `${x.toFixed(2)} ${y.toFixed(2)} ${z.toFixed(2)}`);\n      });\n      \n      const threeDObjects = document.querySelectorAll('.three-d-object');\n      threeDObjects.forEach((object) => {\n        // Random position for 3D objects\n        const x = (Math.random() - 0.5) * 16; // -8 to 8\n        const y = Math.random() * 2;          // 0 to 2\n        const z = -6 - Math.random() * 8;     // -6 to -14\n        object.setAttribute('position', `${x.toFixed(2)} ${y.toFixed(2)} ${z.toFixed(2)}`);\n      });\n    }\n\n    function get3DObjectPosition(index, total) {\n      const x = (index % 3 - 1) * 4;\n      const z = -8 - Math.floor(index / 3) * 4;\n      return `${x} 1 ${z}`;\n    }\n    \n    function getGalleryPosition(index, total) {\n      const cols = Math.ceil(Math.sqrt(total));\n      const row = Math.floor(index / cols);\n      const col = index % cols;\n      const x = (col - (cols - 1) / 2) * 3;\n      const z = -5 - row * 3;\n      return `${x} 1.7 ${z}`;\n    }\n    \n function saveCurrentTransforms() {\n  // Save artwork transforms\n  document.querySelectorAll('.artwork').forEach(artwork => {\n    // Get position as THREE.Vector3 or Object {x, y, z}\n    const pos = artwork.getAttribute('position');\n    const rot = artwork.getAttribute('rotation');\n    const scl = artwork.getAttribute('scale');\n    \n    transforms[artwork.id] = {\n      position: parseVector(pos),\n      rotation: parseVector(rot),\n      scale: parseVector(scl)\n    };\n  });\n\n  // Save 3D object transforms\n    document.querySelectorAll('.three-d-object').forEach(object => {\n      const pos = object.getAttribute('position');\n      const rot = object.getAttribute('rotation');\n      const scl = object.getAttribute('scale');\n      \n      threeDObjectTransforms[object.id] = {\n        position: parseVector(pos),\n        rotation: parseVector(rot),\n        scale: parseVector(scl)\n      };\n    });\n  \n  // Save environment transforms\n  const environmentElements = {\n    floor: document.querySelector('#floor'),\n    walls: document.querySelector('#walls'),\n    ceiling: document.querySelector('#ceiling'),\n    sky: document.querySelector('#sky'),\n    fakeSky: document.querySelector('#fake_sky')\n  };\n  \n  // Create environment transform object\n  Object.entries(environmentElements).forEach(([key, element]) => {\n    if (element) {\n      const pos = element.getAttribute('position');\n      const rot = element.getAttribute('rotation');\n      const scl = element.getAttribute('scale');\n      \n      environmentTransforms[key] = {\n        position: formatVector(parseVector(pos)),\n        rotation: formatVector(parseVector(rot)),\n        scale: formatVector(parseVector(scl))\n      };\n    }\n  });\n  \n  // Save geometry transforms (for room geometries like floor, walls, ceiling)\n  const geometryTransforms = {};\n  \n  // Get all room geometry elements and identify them by their data attribute\n  document.querySelectorAll('.room-geometry[data-geometry-type]').forEach(element => {\n    const type = element.getAttribute('data-geometry-type');\n    const pos = element.getAttribute('position');\n    const rot = element.getAttribute('rotation');\n    const scl = element.getAttribute('scale');\n    \n    geometryTransforms[type] = {\n      position: formatVector(parseVector(pos)),\n      rotation: formatVector(parseVector(rot)),\n      scale: formatVector(parseVector(scl))\n    };\n  });\n  \n  // Capture camera's actual world position and rotation\n  const cameraEl = document.querySelector('[camera]');\n  \n  if (cameraEl && cameraEl.object3D) {\n    // Get camera's world position and rotation\n    const worldPos = new THREE.Vector3();\n    const worldQuat = new THREE.Quaternion();\n    const worldRot = new THREE.Euler();\n    \n    cameraEl.object3D.getWorldPosition(worldPos);\n    cameraEl.object3D.getWorldQuaternion(worldQuat);\n    worldRot.setFromQuaternion(worldQuat);\n    \n    // Convert rotation from radians to degrees\n    const rotDegrees = {\n      x: THREE.MathUtils.radToDeg(worldRot.x),\n      y: THREE.MathUtils.radToDeg(worldRot.y),\n      z: THREE.MathUtils.radToDeg(worldRot.z)\n    };\n    \n    // Save to environment transforms - using string concatenation instead of template literals\n    environmentTransforms.camera = {\n      position: worldPos.x.toFixed(4) + ' ' + worldPos.y.toFixed(4) + ' ' + worldPos.z.toFixed(4),\n      // rotation: rotDegrees.x.toFixed(4) + ' ' + rotDegrees.y.toFixed(4) + ' ' + rotDegrees.z.toFixed(4)\n    };\n  }\n  \n  window.parent.postMessage({ \n    type: 'transforms', \n    data: { \n      artworkTransforms: transforms,\n      threeDObjectTransforms: threeDObjectTransforms,\n      environmentTransforms: environmentTransforms,\n      geometryTransforms: geometryTransforms \n    }\n  }, '*');\n}\n    \n    // Helper function to parse vector3 values\n    function parseVector(vec) {\n      if (typeof vec === 'string') {\n        const [x, y, z] = vec.split(' ').map(parseFloat);\n        return { x, y, z };\n      }\n      \n      return { \n        x: typeof vec.x === 'number' ? vec.x : parseFloat(vec.x),\n        y: typeof vec.y === 'number' ? vec.y : parseFloat(vec.y),\n        z: typeof vec.z === 'number' ? vec.z : parseFloat(vec.z)\n      };\n    }\n    \n    // Helper function to format vector object back to string\n    function formatVector(vec) {\n      return `${vec.x} ${vec.y} ${vec.z}`;\n    }\n    \n    // Function to toggle A-Frame Inspector\n    function toggleInspector() {\n      // Check if inspector is open by looking for the body class\n      if (document.body.classList.contains('aframe-inspector-opened')) {\n        // Inspector is open - close it (Back to Scene button)\n        const backButton = document.querySelector('.toggle-edit');\n        if (backButton) {\n          backButton.click();\n        }\n      } else {\n        // Inspector is closed - look for \"Inspect Scene\" button first\n        const inspectButton = document.querySelector('.toggle-edit');\n        if (inspectButton) {\n          // Use existing \"Inspect Scene\" button\n          inspectButton.click();\n        } else {\n          // Fallback to postMessage for initial opening\n          window.postMessage('INJECT_AFRAME_INSPECTOR', '*');\n        }\n      }\n    }\n  "}generateRandomizedScript(t){return t.randomized?"\n      // Scene is randomized - disable editing\n      console.log('This is a randomized scene configuration');\n    ":""}generate3DObjectComponents(){return"\n    // PLY Loader Component for Point Clouds\n    AFRAME.registerComponent('ply-model', {\n      schema: {\n        src: { type: 'asset' }\n      },\n      \n      init: function() {\n        if (typeof THREE.PLYLoader === 'undefined') {\n          console.warn('PLYLoader not available, skipping PLY model');\n          return;\n        }\n        \n        const loader = new THREE.PLYLoader();\n        const src = this.data.src;\n        \n        loader.load(src, (geometry) => {\n          const material = new THREE.PointsMaterial({ \n            color: 0xffffff, \n            size: 0.02,\n            vertexColors: true\n          });\n          const points = new THREE.Points(geometry, material);\n          this.el.setObject3D('mesh', points);\n        });\n      }\n    });\n    \n    // Enhanced OBJ Loader Component\n    AFRAME.registerComponent('obj-model', {\n      schema: {\n        obj: { type: 'asset' }\n      },\n      \n      init: function() {\n        if (typeof THREE.OBJLoader === 'undefined') {\n          console.warn('OBJLoader not available, skipping OBJ model');\n          return;\n        }\n        \n        const loader = new THREE.OBJLoader();\n        const src = this.data.obj;\n        \n        loader.load(src, (object) => {\n          this.el.setObject3D('mesh', object);\n        });\n      }\n    });\n  "}getDefaultPosition(t,r){const o=Math.ceil(Math.sqrt(r));return`${3*(t%o-(o-1)/2)} 1.7 ${-5-3*Math.floor(t/o)}`}toggleEdit(){this.editMode.update(t=>!t),this.sendToIframe({type:"toggleEdit",enabled:this.editMode()})}rearrangeArtworks(){this.sendToIframe({type:"rearrange"})}saveChanges(){this.sendToIframe({type:"saveTransforms"})}toggleInspector(){this.sendToIframe({type:"toggleInspector"})}sendToIframe(t){const r=document.querySelector("iframe");r?.contentWindow&&r.contentWindow.postMessage(t,"*")}saveTransforms(t){const r=this.config();if(r){if(t.artworkTransforms){const a={...r.artworkTransforms||{},...t.artworkTransforms};r.artworkTransforms=a}if(t.threeDObjectTransforms){const a={...r.threeDObjectTransforms||{},...t.threeDObjectTransforms};r.threeDObjectTransforms=a}if(t.environmentTransforms){const a={...r.environmentTransforms||{},...t.environmentTransforms};r.environmentTransforms=a}if(t.geometryTransforms){const a={...r.geometryTransforms||{},...t.geometryTransforms};r.geometryTransforms=a}this.vrConfigService.update(r.id,{artworkTransforms:r.artworkTransforms,threeDObjectTransforms:r.threeDObjectTransforms,environmentTransforms:r.environmentTransforms,geometryTransforms:r.geometryTransforms}).subscribe({next:()=>{console.log("Transforms saved"),this.toastr.success("VR scene changes saved successfully!","Saved")},error:o=>{console.error("Save failed",o),this.toastr.error("Failed to save changes. Please try again.","Error")}})}}getDefault3DObjectPosition(t,r){return`${4*(t%3-1)} 1 ${-8-4*Math.floor(t/3)}`}handleMessage(t){"transforms"===t.data.type&&this.saveTransforms(t.data.data)}static{this.\u0275fac=function(r){return new(r||h)}}static{this.\u0275cmp=e.VBU({type:h,selectors:[["app-vr-preview"]],hostBindings:function(r,o){1&r&&e.bIt("message",function(n){return o.handleMessage(n)},!1,e.tSv)},standalone:!0,features:[e.aNF],decls:4,vars:3,consts:[[1,"vr-preview-container"],[1,"loading-overlay"],[1,"error-overlay"],["role","status",1,"spinner-border"],[1,"visually-hidden"],[1,"alert","alert-danger"],[1,"vr-controls"],[1,"btn","btn-sm",3,"click"],[1,"btn","btn-sm","btn-info"],[1,"btn","btn-sm","btn-success",3,"click"],["title","Toggle A-Frame Inspector (Ctrl+Alt+I)",1,"btn","btn-sm","btn-warning",3,"click"],[1,"card","iframe-card"],[1,"card-body","p-0"],["frameborder","0","allowfullscreen","","allowvr","",1,"vr-iframe",3,"src"],[1,"btn","btn-sm","btn-info",3,"click"]],template:function(r,o){1&r&&(e.j41(0,"div",0),e.DNE(1,s,4,0,"div",1)(2,f,3,1,"div",2)(3,v,11,7),e.k0s()),2&r&&(e.R7$(),e.vxM(1,o.loading()?1:-1),e.R7$(),e.vxM(2,o.error()?2:-1),e.R7$(),e.vxM(3,o.iframeSrc()&&!o.loading()?3:-1))},dependencies:[g.MD],styles:[".vr-preview-container[_ngcontent-%COMP%]{position:relative;width:100%;height:100vh;margin:0;padding:0;overflow:hidden}.iframe-card[_ngcontent-%COMP%]{height:calc(100vh - 60px);margin:0;border-radius:0;overflow:hidden;box-shadow:none}.vr-iframe[_ngcontent-%COMP%]{width:100%;height:100%;border:none;display:block;overflow:hidden}.loading-overlay[_ngcontent-%COMP%], .error-overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;justify-content:center;align-items:center;background:#000c;z-index:1000}.vr-controls[_ngcontent-%COMP%]{position:absolute;top:30px;right:30px;z-index:100;background:#000000b3;padding:8px;border-radius:4px;display:flex;gap:8px}"]})}}return h})()},2010:(S,w,d)=>{d.d(w,{v:()=>E});var e=d(5312),g=d(4438),b=d(1626);let E=(()=>{class y{constructor(m){this.http=m,this.apiUrl=e.c.apiUrl}findAll(m){return this.http.get(`${this.apiUrl}/${this.endpoint}`,{params:{...m}})}findOne(m){return this.http.get(`${this.apiUrl}/${this.endpoint}/${m}`)}create(m){return this.http.post(`${this.apiUrl}/${this.endpoint}`,m)}update(m,x){return this.http.patch(`${this.apiUrl}/${this.endpoint}/${m}`,x)}remove(m){return this.http.delete(`${this.apiUrl}/${this.endpoint}/${m}`)}static{this.\u0275fac=function(x){return new(x||y)(g.KVO(b.Qq))}}static{this.\u0275prov=g.jDH({token:y,factory:y.\u0275fac})}}return y})()},2249:(S,w,d)=>{d.d(w,{f:()=>E});var e=d(2010),g=d(4438),b=d(1626);let E=(()=>{class y extends e.v{constructor(m){super(m),this.http=m,this.endpoint="hydra-scripts"}getMyScripts(m){return this.http.get(`${this.apiUrl}/${this.endpoint}/my-scripts`,{params:{...m}})}getHydraScript(m){return this.http.get(`${this.apiUrl}/${this.endpoint}/${m}`)}static{this.\u0275fac=function(x){return new(x||y)(g.KVO(b.Qq))}}static{this.\u0275prov=g.jDH({token:y,factory:y.\u0275fac,providedIn:"root"})}}return y})()},3373:(S,w,d)=>{d.d(w,{gA:()=>E,vA:()=>e.v,AF:()=>m,fC:()=>A.f,UN:()=>y,xB:()=>D,RV:()=>x});var e=d(2010),g=d(4438),b=d(1626);let E=(()=>{class c extends e.v{constructor(s){super(s),this.http=s,this.endpoint="artist-profiles"}getMyProfile(){return this.http.get(`${this.apiUrl}/${this.endpoint}/my-profile`)}publishArtistSite(s){return this.http.post(`${this.apiUrl}/${this.endpoint}/${s}/publish`,{})}static{this.\u0275fac=function(f){return new(f||c)(g.KVO(b.Qq))}}static{this.\u0275prov=g.jDH({token:c,factory:c.\u0275fac,providedIn:"root"})}}return c})(),y=(()=>{class c extends e.v{constructor(s){super(s),this.http=s,this.endpoint="kwalhia-art"}getAllArtworks(s){return this.findAll(s)}getMyArtworks(s){return this.http.get(`${this.apiUrl}/${this.endpoint}/my-artwork`,{params:{...s}})}getArtwork(s){return this.findOne(s)}uploadArtwork(s,f,$){const v=new FormData;return v.append("file",f),v.append("aspectRatio",$),Object.entries(s).forEach(([k,h])=>{null!=h&&v.append(k,h.toString())}),this.http.post(`${this.apiUrl}/${this.endpoint}`,v)}updateArtwork(s,f,$){const v=new FormData;return $&&v.append("file",$),Object.entries(f).forEach(([k,h])=>{null!=h&&v.append(k,h.toString())}),this.http.patch(`${this.apiUrl}/${this.endpoint}/${s}`,v)}uploadWithFormData(s){return this.http.post(`${this.apiUrl}/${this.endpoint}`,s)}deleteArtwork(s){return this.remove(s)}create(s){return console.warn("Please use uploadArtwork method instead of create for adding new artwork"),super.create(s)}static{this.\u0275fac=function(f){return new(f||c)(g.KVO(b.Qq))}}static{this.\u0275prov=g.jDH({token:c,factory:c.\u0275fac,providedIn:"root"})}}return c})(),D=(()=>{class c extends e.v{constructor(s){super(s),this.http=s,this.endpoint="series"}getMySeries(s){return this.http.get(`${this.apiUrl}/${this.endpoint}/my-series`,{params:{...s}})}static{this.\u0275fac=function(f){return new(f||c)(g.KVO(b.Qq))}}static{this.\u0275prov=g.jDH({token:c,factory:c.\u0275fac,providedIn:"root"})}}return c})(),m=(()=>{class c extends e.v{constructor(s){super(s),this.http=s,this.endpoint="galleries"}getMyGallery(){return this.http.get(`${this.apiUrl}/${this.endpoint}/my-gallery`)}static{this.\u0275fac=function(f){return new(f||c)(g.KVO(b.Qq))}}static{this.\u0275prov=g.jDH({token:c,factory:c.\u0275fac,providedIn:"root"})}}return c})(),x=(()=>{class c extends e.v{constructor(s){super(s),this.http=s,this.endpoint="textures"}getTexture(s){return this.http.get(`${this.apiUrl}/${this.endpoint}/${s}`)}getMyTextures(s){return this.http.get(`${this.apiUrl}/${this.endpoint}/my-textures`,{params:{...s}})}getTexturesByType(s,f){return this.http.get(`${this.apiUrl}/${this.endpoint}/type/${s}`,{params:{...f}})}uploadTexture(s,f,$=!1){const v=new FormData;return v.append("file",f),v.append("type",s),v.append("isPublic",$.toString()),this.http.post(`${this.apiUrl}/${this.endpoint}`,v)}static{this.\u0275fac=function(f){return new(f||c)(g.KVO(b.Qq))}}static{this.\u0275prov=g.jDH({token:c,factory:c.\u0275fac,providedIn:"root"})}}return c})();var A=d(2249)}}]);